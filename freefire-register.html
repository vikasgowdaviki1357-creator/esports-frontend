<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FREE FIRE Registration â€” RV Esports Arena</title>

<style>
/* your same CSS here â€” unchanged */
</style>
</head>

<body>

<section class="hero">
  <div class="hero-inner">
    <div>
      <h2>Join & Win Esports Tournaments</h2>
      <p>FREE FIRE â€¢ BGMI</p>
    </div>

    <aside class="panel">
      <h3>FREE FIRE â€” Squad Registration</h3>

      <div class="info-box">
        <p><b>Match Type:</b> Bermuda</p>
        <p><b>Entry Fee:</b> â‚¹60 / Squad</p>
        <p><b>Total Teams:</b> 12</p>
        <p style="color:#9fffe3;font-weight:bold">ğŸ†1st Winner Gets: â‚¹200</p>
        <p style="color:#9fffe3;font-weight:bold">ğŸ†2nd Winner Gets: â‚¹150</p>
        <p style="color:#9fffe3;font-weight:bold">ğŸ†3rd Winner Gets: â‚¹100</p>
      </div>

      <div id="slotInfo" class="slot-box"></div>

      <form id="regForm">

        <input id="name" placeholder="Team Name" required>
        <input id="player1Id" placeholder="Player 1 In-Game ID" required>
        <input id="player2Id" placeholder="Player 2 In-Game ID" required>
        <input id="player3Id" placeholder="Player 3 In-Game ID" required>
        <input id="player4Id" placeholder="Player 4 In-Game ID" required>

        <input id="phone" placeholder="Phone number" required>
        <input id="playerUpi" placeholder="Your UPI ID (for winnings)" required>

        <p style="font-size:13px;color:#ccc;margin:10px 0">
          Pay â‚¹60 to UPI: <strong>rk23sd@oksbi</strong>
        </p>

        <input id="screenshot" type="file" accept="image/*" required>

        <button id="submitBtn" class="btn" type="submit">
          Submit Registration
        </button>

        <div id="status" class="msg"></div>
      </form>
    </aside>
  </div>
</section>

<script>
const API_BASE = "https://esports-backend-2n67.onrender.com";
const matchId = "FF-SQUAD-1";

// Load slots
async function loadSlots() {
  try {
    const res = await fetch(`${API_BASE}/api/match-slots/${matchId}`);
    const data = await res.json();

    const slotInfo = document.getElementById("slotInfo");
    const submitBtn = document.getElementById("submitBtn");

    slotInfo.innerHTML = `ğŸ”¥ Slots Filled: ${data.registered}/${data.total} | Remaining: ${data.remaining}`;

    if (data.remaining <= 0) {
      slotInfo.innerHTML += " âŒ REGISTRATION CLOSED";
      slotInfo.style.color = "red";
      submitBtn.disabled = true;
    } else if (data.remaining <= 3) {
      slotInfo.style.color = "orange";
      submitBtn.disabled = false;
    } else {
      slotInfo.style.color = "#9fffe3";
      submitBtn.disabled = false;
    }

  } catch (err) {
    console.log("Slot load error:", err);
  }
}

document.addEventListener("DOMContentLoaded", loadSlots);
setInterval(loadSlots, 5000);

// Submit registration
document.getElementById("regForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const token = localStorage.getItem("token");
  if (!token) {
    alert("Please login first");
    window.location.href = "login.html";
    return;
  }

  const teamName = document.getElementById("name").value.trim();
  const p1 = document.getElementById("player1Id").value.trim();
  const p2 = document.getElementById("player2Id").value.trim();
  const p3 = document.getElementById("player3Id").value.trim();
  const p4 = document.getElementById("player4Id").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const upi = document.getElementById("playerUpi").value.trim();
  const screenshotFile = document.getElementById("screenshot").files[0];

  if (!teamName || !p1 || !p2 || !p3 || !p4 || !phone || !upi || !screenshotFile) {
    alert("Please fill all fields");
    return;
  }

  const reader = new FileReader();
  reader.readAsDataURL(screenshotFile);

  reader.onload = async function () {
    try {
      const res = await fetch(`${API_BASE}/api/join-match`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify({
          matchId,
          teamName,
          squadIds: [p1, p2, p3, p4],
          phone,
          playerUpi: upi,
          screenshot: reader.result
        })
      });

      const data = await res.json();

      if (!res.ok) {
        alert(data.message || "Registration failed");
        return;
      }

      alert("Registration submitted successfully!");
      window.location.href = "player-dashboard.html";

    } catch (err) {
      console.error("Join-match error:", err);
      alert("Something went wrong");
    }
  };
});
</script>

</body>
</html>
