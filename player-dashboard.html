<!DOCTYPE html>
<html>
<head>
  <title>Player Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<h2>üî• My Tournament Status</h2>

<div id="matches"></div>

<script>
const API_BASE = "https://esports-backend-2n67.onrender.com";

document.addEventListener("DOMContentLoaded", async () => {

  const token = localStorage.getItem("token");

  if (!token) {
    window.location.href = "login.html";
    return;
  }

  const container = document.getElementById("matches");
  container.innerHTML = "<p>Loading your matches...</p>";

  try {

    const response = await fetch(`${API_BASE}/api/my-registrations`, {
      headers: {
        "Authorization": "Bearer " + token
      }
    });

    const data = await response.json();

    if (!response.ok) {
      container.innerHTML = data.message || "‚ùå Error loading matches.";
      return;
    }

    container.innerHTML = "";

    if (!data || data.length === 0) {
      container.innerHTML = "<p>No matches joined yet.</p>";
      return;
    }

    data.forEach(reg => {

      const match = reg.match || {};

      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <h3>${match.game || match.matchId || "Match"}</h3>
        <p><strong>Status:</strong> ${reg.status || "pending"}</p>
        <p>üìÖ ${reg.matchDate || "Date not announced"}</p>
        <p>‚è∞ ${reg.matchTime || "Time not announced"}</p>
        <p><strong>Room ID:</strong> ${reg.roomID || "Not assigned yet"}</p>
        <p><strong>Password:</strong> ${reg.roomPassword || "Not assigned yet"}</p>
      `;

      container.appendChild(card);
    });

  } catch (error) {
    console.error("Dashboard error:", error);
    container.innerHTML = "<p>‚ùå Error loading matches. Try again.</p>";
  }

});
</script>

</body>
</html>
